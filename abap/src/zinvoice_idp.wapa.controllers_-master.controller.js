sap.ui.define(["aws/fin/ap/controllers/BaseController","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/MessageBox","sap/ui/core/BusyIndicator","sap/ui/core/library","sap/ui/core/Fragment","sap/ui/model/BindingMode"],function(e,t,s,i,a,o,r,n){"u+
se strict";var d=o.MessageType;return e.extend("aws.fin.ap.controllers.Master",{onInit:function(){var e;e=new t({busy:false,delay:0,showCustomListItem:false,showheaderToolbar:false});this.oList=this.byId("idInvoicesList");this.setModel(e,"masterView");va+
r s=new t({email:""});this.setModel(s,"subscription");this.getModel("subscription").setDefaultBindingMode(n.TwoWay);this.messageManager=sap.ui.getCore().getMessageManager();this.messageManager.registerObject(this.getView(),true);this.oRouter=this.getOwne+
rComponent().getRouter();this.oRouter.getRoute("start").attachMatched(this.onMasterRouteMatched,this);this.oRouter.getRoute("detail").attachMatched(this.onDetailRouteMatched,this);this.toggleUploadButtons()},toggleUploadButtons:function(){var e=this.getO+
wnerComponent().getModel();e.read("/Invoices/$count",{success:function(e){if(e>0){this.getModel("masterView").setProperty("/showCustomListItem",false);this.getModel("masterView").setProperty("/showheaderToolbar",true)}else{this.getModel("masterView").set+
Property("/showCustomListItem",true)}}.bind(this),error:function(e){}})},onDetailRouteMatched:function(e){var t=e.getParameter("arguments").invoiceId;this.getModel().metadataLoaded().then(function(){this.sDesiredItemPath=this.getModel().createKey("Invoic+
es",{invoiceNumber:t});if(this.oList.getItems().length){this.setSelectedItem(this.sDesiredItemPath)}else{this.onListLoaded().then(function(){this.setSelectedItem(this.sDesiredItemPath)}.bind(this))}}.bind(this))},setSelectedItem:function(e){var t="/"+e;v+
ar s=this.oList.getSelectedItem();if(s&&s.getBindingContext().getPath()===t){return}this.oList.getItems().some(function(e){if(e.getBindingContext()&&e.getBindingContext().getPath()===t){this.oList.setSelectedItem(e);return}}.bind(this))},onListLoaded:fun+
ction(){return new Promise(function(e,t){this.oList.getBinding("items").attachEventOnce("dataReceived",function(){if(this.oList.getItems().length){e(true)}else{t(false)}}.bind(this))}.bind(this))},onMasterRouteMatched:function(e){this.oList.removeSelecti+
ons(true);this.toggleLayout()},onInvoicesListSelectionChange:function(e){var t=this.getOwnerComponent().getRouter();var s=e.getSource();var i=s.getSelectedItem().getBindingContext();t.navTo("detail",{invoiceId:i.getProperty("invoiceNumber")})},onFileUplo+
aderChange:function(e){var t=e.getSource();var i=e.getParameter("files");if(i.length>0){var o=i[i.length-1]}t.removeAllHeaderParameters();t.setUseMultipart(false);t.setSendXHR(true);var r=this.getOwnerComponent().getModel().getSecurityToken();t.addHeader+
Parameter(new sap.ui.unified.FileUploaderParameter({name:"x-csrf-token",value:r}));t.addHeaderParameter(new sap.ui.unified.FileUploaderParameter({name:"slug",value:o.name}));var n=this;a.show();t.checkFileReadable().then(function(){t.upload();t.destroyHe+
aderParameters()},function(e){s.show("File cannot be read");a.hide()}).then(function(){t.clear()})},onFileUploaderUploadComplete:function(e){var t=e.getParameter("responseRaw");var o=e.getParameter("status");var r=new DOMParser;if(o===200||o===201){a.hid+
e();s.show("Document was uploaded and extracted sucessfully");this.getModel().refresh()}else{switch(o){case 400:var n=r.parseFromString(t,"text/xml");i.error(n.getElementsByTagName("message")[0].innerHTML);break;case 500:i.error("Error occured while uplo+
ading Invoice - contact Administrator");default:break}a.hide()}this.toggleUploadButtons()},setAppBusy:function(e){this.getModel("masterView").setProperty("/busy",e)},onSubscribeToAlertsButtonPress:function(e){var t=e.getSource(),s=this.getView();if(!this+
._pPopover){this._pPopover=r.load({id:s.getId(),name:"aws.fin.ap.fragments.popover",type:"XML",controller:this}).then(function(e){s.addDependent(e);return e})}this._pPopover.then(function(e){this.getModel("subscription").setProperty("/email","");e.openBy+
(t)}.bind(this))},onSubscribeButtonPress:function(e){var t=this.byId("idEmailInput");this.validateEmail(t);if(!this.messageManager.getMessageModel().getData().length>0){this.getModel().callFunction("/SubscribetoAlerts",{error:function(e){i.error(this.get+
ResourceBundle().getText("msgsubscriptionerror"));a.hide()},success:function(e){a.hide();s.show(this.getResourceBundle().getText("msgsubscription"),{duration:4e3})}.bind(this),method:"POST",urlParameters:{email:t.getValue()}})}},onEmailInputChange:functi+
on(e){var t=e.getSource();this.validateEmail(t)},removeMessagefromTarget:function(e){this.messageManager.getMessageModel().getData().forEach(function(t){if(t.target===e){this.messageManager.removeMessages(t)}}.bind(this))},validateEmail:function(e){var t+
=e.getBindingPath("value");var s=e.getBinding("value");var i=this.getModel("subscription");this.removeMessagefromTarget(t);try{s.getType().validateValue(e.getValue())}catch(e){this.messageManager.addMessages(new Message({message:e.message,type:d.Error,ta+
rget:t,processor:i}))}}})});                                                                                                                                                                                                                                   
//# sourceMappingURL=Master.controller.js.map                                                                                                                                                                                                                  